<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>趣味答题小游戏</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            color: #333;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(90deg, #4a00e0, #8e2de2);
            color: white;
            padding: 25px 30px;
            text-align: center;
            position: relative;
        }
        
        .logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 10px;
        }
        
        .logo i {
            font-size: 2.5rem;
            color: #FFD700;
        }
        
        h1 {
            font-size: 2.8rem;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .date-time {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 1.1rem;
            background: rgba(0, 0, 0, 0.2);
            padding: 8px 15px;
            border-radius: 20px;
        }
        
        .game-area {
            padding: 30px;
            min-height: 600px;
        }
        
        /* 页面通用样式 */
        .page {
            display: none;
            animation: fadeIn 0.5s ease;
        }
        
        .page.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        /* 登录注册页面 */
        .auth-form {
            max-width: 500px;
            margin: 40px auto;
            padding: 30px;
            border-radius: 15px;
            background: #f8f9ff;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }
        
        .form-title {
            text-align: center;
            margin-bottom: 30px;
            color: #4a00e0;
            font-size: 1.8rem;
        }
        
        .form-group {
            margin-bottom: 25px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }
        
        .form-group input {
            width: 100%;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 1.1rem;
            transition: border-color 0.3s;
        }
        
        .form-group input:focus {
            border-color: #8e2de2;
            outline: none;
        }
        
        .btn {
            display: block;
            width: 100%;
            padding: 16px;
            background: linear-gradient(90deg, #4a00e0, #8e2de2);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.2rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 7px 15px rgba(142, 45, 226, 0.3);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .switch-auth {
            text-align: center;
            margin-top: 25px;
            color: #666;
        }
        
        .switch-auth span {
            color: #4a00e0;
            cursor: pointer;
            font-weight: 600;
            text-decoration: underline;
        }
        
        /* 游戏主页 */
        .welcome {
            text-align: center;
            margin-bottom: 30px;
            color: #4a00e0;
        }
        
        .user-info {
            display: flex;
            justify-content: space-between;
            background: linear-gradient(90deg, #f8f9ff, #eef2ff);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }
        
        .stats {
            display: flex;
            gap: 20px;
        }
        
        .stat-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            background: white;
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
        }
        
        .stat-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: #4a00e0;
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: #666;
            margin-top: 5px;
        }
        
        .game-modes {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }
        
        .mode-card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s;
            cursor: pointer;
            border: 3px solid transparent;
        }
        
        .mode-card:hover {
            transform: translateY(-10px);
            border-color: #8e2de2;
        }
        
        .mode-icon {
            font-size: 3.5rem;
            margin-bottom: 20px;
            color: #4a00e0;
        }
        
        .mode-title {
            font-size: 1.8rem;
            margin-bottom: 15px;
            color: #333;
        }
        
        .mode-desc {
            color: #666;
            line-height: 1.6;
            margin-bottom: 20px;
        }
        
        .game-actions {
            display: flex;
            justify-content: center;
            gap: 20px;
        }
        
        .action-btn {
            padding: 12px 25px;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            border: none;
            font-size: 1.1rem;
            transition: all 0.3s;
        }
        
        .action-btn.logout {
            background: #f8f9ff;
            color: #4a00e0;
            border: 2px solid #4a00e0;
        }
        
        .action-btn.ranking {
            background: linear-gradient(90deg, #FFD700, #FFA500);
            color: white;
        }
        
        .action-btn.rules {
            background: linear-gradient(90deg, #00b09b, #96c93d);
            color: white;
        }
        
        /* 游戏规则页面 */
        .rules-container {
            max-width: 700px;
            margin: 0 auto;
        }
        
        .rules-list {
            background: #f8f9ff;
            border-radius: 15px;
            padding: 30px;
            margin-top: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }
        
        .rule-item {
            display: flex;
            align-items: flex-start;
            margin-bottom: 25px;
            padding-bottom: 25px;
            border-bottom: 1px dashed #ddd;
        }
        
        .rule-item:last-child {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }
        
        .rule-icon {
            font-size: 1.8rem;
            color: #4a00e0;
            margin-right: 20px;
            min-width: 40px;
        }
        
        .rule-content h3 {
            margin-bottom: 10px;
            color: #333;
        }
        
        .rule-content p {
            color: #666;
            line-height: 1.6;
        }
        
        /* 答题页面 */
        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #f0f0f0;
        }
        
        .game-stats {
            display: flex;
            gap: 20px;
        }
        
        .hearts {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .heart {
            color: #ff4757;
            font-size: 1.8rem;
        }
        
        .stars {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .star {
            color: #FFD700;
            font-size: 1.8rem;
        }
        
        .timer {
            font-size: 1.5rem;
            font-weight: 700;
            color: #4a00e0;
            background: #f0f0ff;
            padding: 10px 20px;
            border-radius: 10px;
        }
        
        .question-container {
            background: #f8f9ff;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }
        
        .question-title {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: #333;
        }
        
        .question {
            font-size: 1.8rem;
            text-align: center;
            margin: 30px 0;
            color: #4a00e0;
            font-weight: 700;
        }
        
        .idiom-hint {
            font-size: 1.3rem;
            text-align: center;
            color: #666;
            margin-top: 15px;
            font-style: italic;
        }
        
        .options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        
        .option {
            background: white;
            border: 2px solid #e0e0ff;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            font-size: 1.3rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .option:hover {
            background: #f0f0ff;
            border-color: #8e2de2;
        }
        
        .option.selected {
            background: #8e2de2;
            color: white;
            border-color: #8e2de2;
        }
        
        .option.correct {
            background: #4CAF50;
            color: white;
            border-color: #4CAF50;
        }
        
        .option.incorrect {
            background: #ff4757;
            color: white;
            border-color: #ff4757;
        }
        
        .game-controls {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
        }
        
        .hint-container {
            margin-top: 20px;
            padding: 15px;
            background: #fff9e6;
            border-radius: 10px;
            border-left: 5px solid #FFD700;
        }
        
        .hint-content {
            color: #8a6d3b;
            font-size: 1.1rem;
            line-height: 1.6;
        }
        
        .hint-btn {
            background: linear-gradient(90deg, #00b09b, #96c93d);
            color: white;
            border: none;
            border-radius: 10px;
            padding: 12px 25px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .hint-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 10px rgba(0, 176, 155, 0.3);
        }
        
        .hint-btn:disabled {
            background: #cccccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        /* 结果页面 */
        .result-container {
            text-align: center;
            padding: 40px 20px;
        }
        
        .result-title {
            font-size: 2.5rem;
            margin-bottom: 30px;
            color: #4a00e0;
        }
        
        .result-score {
            font-size: 4rem;
            color: #FFD700;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
            margin: 20px 0;
        }
        
        .result-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 40px 0;
        }
        
        .result-stat {
            background: #f8f9ff;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }
        
        .result-stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: #4a00e0;
            margin-bottom: 10px;
        }
        
        /* 排行榜页面 */
        .ranking-container {
            padding: 20px;
        }
        
        .ranking-title {
            text-align: center;
            font-size: 2.2rem;
            margin-bottom: 30px;
            color: #4a00e0;
        }
        
        .ranking-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }
        
        .ranking-table th {
            background: linear-gradient(90deg, #4a00e0, #8e2de2);
            color: white;
            padding: 20px;
            text-align: left;
        }
        
        .ranking-table td {
            padding: 20px;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .ranking-table tr:last-child td {
            border-bottom: none;
        }
        
        .ranking-table tr:nth-child(even) {
            background-color: #f8f9ff;
        }
        
        .rank {
            font-weight: 700;
            font-size: 1.3rem;
            width: 60px;
        }
        
        .rank-1 {
            color: #FFD700;
        }
        
        .rank-2 {
            color: #C0C0C0;
        }
        
        .rank-3 {
            color: #CD7F32;
        }
        
        /* 响应式设计 */
        @media (max-width: 768px) {
            .container {
                border-radius: 10px;
            }
            
            h1 {
                font-size: 2.2rem;
            }
            
            .date-time {
                position: static;
                margin-top: 15px;
                display: inline-block;
            }
            
            .game-modes {
                grid-template-columns: 1fr;
            }
            
            .user-info {
                flex-direction: column;
                gap: 20px;
            }
            
            .game-header {
                flex-direction: column;
                gap: 20px;
            }
            
            .options {
                grid-template-columns: 1fr;
            }
            
            .result-stats {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <i class="fas fa-gamepad"></i>
                <h1>趣味答题小游戏</h1>
            </div>
            <div class="date-time" id="dateTime">正在加载时间...</div>
        </header>
        
        <div class="game-area">
            <!-- 登录页面 -->
            <div class="page active" id="loginPage">
                <div class="auth-form">
                    <h2 class="form-title">用户登录</h2>
                    <div class="form-group">
                        <label for="loginUsername">用户名</label>
                        <input type="text" id="loginUsername" placeholder="请输入用户名">
                    </div>
                    <div class="form-group">
                        <label for="loginPassword">密码</label>
                        <input type="password" id="loginPassword" placeholder="请输入密码">
                    </div>
                    <button class="btn" id="loginBtn">登录</button>
                    <div class="switch-auth">
                        还没有账户？<span id="goToRegister">立即注册</span>
                    </div>
                </div>
            </div>
            
            <!-- 注册页面 -->
            <div class="page" id="registerPage">
                <div class="auth-form">
                    <h2 class="form-title">用户注册</h2>
                    <div class="form-group">
                        <label for="registerUsername">用户名</label>
                        <input type="text" id="registerUsername" placeholder="请输入用户名">
                    </div>
                    <div class="form-group">
                        <label for="registerPassword">密码</label>
                        <input type="password" id="registerPassword" placeholder="请输入密码（至少6位）">
                    </div>
                    <div class="form-group">
                        <label for="confirmPassword">确认密码</label>
                        <input type="password" id="confirmPassword" placeholder="请再次输入密码">
                    </div>
                    <button class="btn" id="registerBtn">注册</button>
                    <div class="switch-auth">
                        已有账户？<span id="goToLogin">立即登录</span>
                    </div>
                </div>
            </div>
            
            <!-- 游戏主页 -->
            <div class="page" id="gameHomePage">
                <h2 class="welcome" id="welcomeMessage">欢迎回来，玩家！</h2>
                
                <div class="user-info">
                    <div class="stats">
                        <div class="stat-item">
                            <div class="stat-value" id="totalStars">0</div>
                            <div class="stat-label">总星星数</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="gamesPlayed">0</div>
                            <div class="stat-label">游戏次数</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="bestScore">0</div>
                            <div class="stat-label">最高得分</div>
                        </div>
                    </div>
                </div>
                
                <div class="game-modes">
                    <div class="mode-card" id="idiomMode">
                        <div class="mode-icon">
                            <i class="fas fa-puzzle-piece"></i>
                        </div>
                        <h3 class="mode-title">成语填空</h3>
                        <p class="mode-desc">根据提示填写正确的成语，考验您的成语储备量。每题限时30秒。</p>
                        <div class="stats">
                            <div class="stat-item">
                                <div class="stat-value" id="idiomPlayed">0</div>
                                <div class="stat-label">已玩次数</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value" id="idiomBest">0</div>
                                <div class="stat-label">最高得分</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mode-card" id="lyricMode">
                        <div class="mode-icon">
                            <i class="fas fa-music"></i>
                        </div>
                        <h3 class="mode-title">歌词猜歌名</h3>
                        <p class="mode-desc">根据给出的歌词猜出正确的歌曲名称，考验您的音乐知识。每题限时20秒。</p>
                        <div class="stats">
                            <div class="stat-item">
                                <div class="stat-value" id="lyricPlayed">0</div>
                                <div class="stat-label">已玩次数</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value" id="lyricBest">0</div>
                                <div class="stat-label">最高得分</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="game-actions">
                    <button class="action-btn rules" id="rulesBtn">游戏规则</button>
                    <button class="action-btn ranking" id="rankingBtn">查看排行榜</button>
                    <button class="action-btn logout" id="logoutBtn">退出登录</button>
                </div>
            </div>
            
            <!-- 游戏规则页面 -->
            <div class="page" id="rulesPage">
                <h2 class="form-title">游戏规则</h2>
                <div class="rules-container">
                    <div class="rules-list">
                        <div class="rule-item">
                            <div class="rule-icon">
                                <i class="fas fa-user-plus"></i>
                            </div>
                            <div class="rule-content">
                                <h3>注册与登录</h3>
                                <p>首次使用需要注册账号，注册后可以登录游戏并保存您的游戏进度和成绩。</p>
                            </div>
                        </div>
                        <div class="rule-item">
                            <div class="rule-icon">
                                <i class="fas fa-gamepad"></i>
                            </div>
                            <div class="rule-content">
                                <h3>游戏模式</h3>
                                <p>游戏包含两种模式：成语填空和歌词猜歌名。每种模式都有5-10道不重复的题目。</p>
                            </div>
                        </div>
                        <div class="rule-item">
                            <div class="rule-icon">
                                <i class="fas fa-clock"></i>
                            </div>
                            <div class="rule-content">
                                <h3>时间限制</h3>
                                <p>成语填空每题限时30秒，歌词猜歌名每题限时20秒。超时未答视为答错。</p>
                            </div>
                        </div>
                        <div class="rule-item">
                            <div class="rule-icon">
                                <i class="fas fa-heart"></i>
                            </div>
                            <div class="rule-content">
                                <h3>生命值与星星</h3>
                                <p>开始游戏时有3颗爱心❤️，答错一题扣除一颗爱心，爱心为0时游戏结束。答对题目可以获得星星⭐奖励。</p>
                            </div>
                        </div>
                        <div class="rule-item">
                            <div class="rule-icon">
                                <i class="fas fa-lightbulb"></i>
                            </div>
                            <div class="rule-content">
                                <h3>提示功能</h3>
                                <p>每道题可以使用提示功能，但使用提示会减少该题获得的星星数量。成语模式使用提示得1星，歌词模式使用提示得2星。</p>
                            </div>
                        </div>
                        <div class="rule-item">
                            <div class="rule-icon">
                                <i class="fas fa-trophy"></i>
                            </div>
                            <div class="rule-content">
                                <h3>排行榜</h3>
                                <p>游戏结束后，您的成绩将计入排行榜。排行榜显示所有玩家的总星星数和最高得分。</p>
                            </div>
                        </div>
                    </div>
                    <button class="btn" id="backFromRules">返回主界面</button>
                </div>
            </div>
            
            <!-- 成语填空游戏页面 -->
            <div class="page" id="idiomGamePage">
                <div class="game-header">
                    <div class="game-stats">
                        <div class="hearts">
                            <span class="heart" id="heart1">❤️</span>
                            <span class="heart" id="heart2">❤️</span>
                            <span class="heart" id="heart3">❤️</span>
                        </div>
                        <div class="stars">
                            <span class="star">⭐</span>
                            <span id="currentStars">0</span>
                        </div>
                    </div>
                    <div class="timer" id="idiomTimer">30</div>
                </div>
                
                <div class="question-container">
                    <h3 class="question-title">成语填空 (第<span id="idiomQuestionNum">1</span>/10题)</h3>
                    <div class="question" id="idiomQuestion">题目加载中...</div>
                    <div class="idiom-hint" id="idiomHint">提示：</div>
                    
                    <div id="idiomHintContainer" style="display: none;">
                        <div class="hint-container">
                            <div class="hint-content" id="idiomHintContent"></div>
                        </div>
                    </div>
                    
                    <button class="hint-btn" id="idiomHintBtn">
                        <i class="fas fa-lightbulb"></i> 获取提示 (消耗1⭐)
                    </button>
                    
                    <div class="options" id="idiomOptions">
                        <!-- 选项会通过JavaScript动态生成 -->
                    </div>
                    
                    <div class="game-controls">
                        <button class="action-btn logout" id="quitIdiomGame">退出游戏</button>
                        <button class="action-btn ranking" id="nextIdiomQuestion" disabled>下一题</button>
                    </div>
                </div>
            </div>
            
            <!-- 歌词猜歌名游戏页面 -->
            <div class="page" id="lyricGamePage">
                <div class="game-header">
                    <div class="game-stats">
                        <div class="hearts">
                            <span class="heart" id="heart4">❤️</span>
                            <span class="heart" id="heart5">❤️</span>
                            <span class="heart" id="heart6">❤️</span>
                        </div>
                        <div class="stars">
                            <span class="star">⭐</span>
                            <span id="currentLyricStars">0</span>
                        </div>
                    </div>
                    <div class="timer" id="lyricTimer">20</div>
                </div>
                
                <div class="question-container">
                    <h3 class="question-title">歌词猜歌名 (第<span id="lyricQuestionNum">1</span>/8题)</h3>
                    <div class="question" id="lyricQuestion">歌词加载中...</div>
                    
                    <div id="lyricHintContainer" style="display: none;">
                        <div class="hint-container">
                            <div class="hint-content" id="lyricHintContent"></div>
                        </div>
                    </div>
                    
                    <button class="hint-btn" id="lyricHintBtn">
                        <i class="fas fa-lightbulb"></i> 获取提示 (消耗1⭐)
                    </button>
                    
                    <div class="options" id="lyricOptions">
                        <!-- 选项会通过JavaScript动态生成 -->
                    </div>
                    
                    <div class="game-controls">
                        <button class="action-btn logout" id="quitLyricGame">退出游戏</button>
                        <button class="action-btn ranking" id="nextLyricQuestion" disabled>下一题</button>
                    </div>
                </div>
            </div>
            
            <!-- 游戏结果页面 -->
            <div class="page" id="resultPage">
                <div class="result-container">
                    <h2 class="result-title" id="resultTitle">游戏结束</h2>
                    <div class="result-score" id="finalScore">0 ⭐</div>
                    
                    <div class="result-stats">
                        <div class="result-stat">
                            <div class="result-stat-value" id="resultCorrect">0</div>
                            <div class="stat-label">答对题数</div>
                        </div>
                        <div class="result-stat">
                            <div class="result-stat-value" id="resultTime">0</div>
                            <div class="stat-label">用时(秒)</div>
                        </div>
                        <div class="result-stat">
                            <div class="result-stat-value" id="resultStars">0</div>
                            <div class="stat-label">获得星星</div>
                        </div>
                        <div class="result-stat">
                            <div class="result-stat-value" id="resultHints">0</div>
                            <div class="stat-label">提示使用</div>
                        </div>
                    </div>
                    
                    <button class="btn" id="backToHome">返回主界面</button>
                </div>
            </div>
            
            <!-- 排行榜页面 -->
            <div class="page" id="rankingPage">
                <h2 class="ranking-title">玩家排行榜</h2>
                <div class="ranking-container">
                    <table class="ranking-table">
                        <thead>
                            <tr>
                                <th>排名</th>
                                <th>用户名</th>
                                <th>总星星数</th>
                                <th>最高得分</th>
                                <th>游戏次数</th>
                            </tr>
                        </thead>
                        <tbody id="rankingBody">
                            <!-- 排行榜数据会通过JavaScript动态生成 -->
                        </tbody>
                    </table>
                    <button class="btn" id="backFromRanking" style="margin-top: 30px;">返回主界面</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 游戏数据
        const gameData = {
            currentUser: null,
            users: JSON.parse(localStorage.getItem('quizGameUsers')) || [],
            rankings: JSON.parse(localStorage.getItem('quizGameRankings')) || [],
            currentGame: {
                mode: null,
                questions: [],
                currentQuestionIndex: 0,
                hearts: 3,
                stars: 0,
                correctAnswers: 0,
                startTime: null,
                totalTime: 0,
                hintsUsed: 0,
                currentQuestionHintUsed: false
            }
        };

        // 成语题库（增加提示内容）
        const idiomQuestions = [
            {
                question: "一__知秋",
                answer: "叶",
                hint: "比喻通过个别的细微的迹象，可以看到整个形势的发展趋向与结果。",
                hintText: "这个成语来自《淮南子·说山训》，意思是看到一片叶子落下就知道秋天来了。",
                options: ["叶", "夜", "页", "业"]
            },
            {
                question: "画龙点__",
                answer: "睛",
                hint: "比喻写文章或讲话时，在关键处用几句话点明实质，使内容更加生动有力。",
                hintText: "传说梁代画家张僧繇在墙上画了四条龙，没有画眼睛，后来点了其中两条的眼睛，龙就飞走了。",
                options: ["睛", "精", "晶", "京"]
            },
            {
                question: "守株待__",
                answer: "兔",
                hint: "比喻死守狭隘经验，不知变通，或抱着侥幸心理妄想不劳而获。",
                hintText: "出自《韩非子·五蠹》，讲一个农夫捡到撞死在树桩上的兔子后，就守在树桩旁等待更多的兔子。",
                options: ["兔", "鹿", "羊", "猪"]
            },
            {
                question: "对牛弹__",
                answer: "琴",
                hint: "比喻对不懂道理的人讲道理，对外行人说内行话。也用来讥笑说话的人不看对象。",
                hintText: "出自《庄子·齐物论》，原意是给牛弹琴，牛听不懂。现在比喻说话不看对象。",
                options: ["琴", "瑟", "筝", "琵"]
            },
            {
                question: "狐假__威",
                answer: "虎",
                hint: "比喻仰仗或倚仗别人的权势来欺压、恐吓人。",
                hintText: "出自《战国策·楚策一》，狐狸借老虎的威势吓唬其他动物。",
                options: ["虎", "狼", "豹", "狮"]
            },
            {
                question: "亡羊补__",
                answer: "牢",
                hint: "比喻出了问题以后想办法补救，免得以后继续受损失。",
                hintText: "出自《战国策·楚策四》，意思是丢失了羊以后才修补羊圈。",
                options: ["牢", "圈", "栏", "网"]
            },
            {
                question: "井底之__",
                answer: "蛙",
                hint: "比喻见识狭窄的人。",
                hintText: "出自《庄子·秋水》，井里的青蛙只能看到井口那么大的一片天。",
                options: ["蛙", "鱼", "虾", "虫"]
            },
            {
                question: "望梅止__",
                answer: "渴",
                hint: "比喻愿望无法实现，用空想安慰自己。",
                hintText: "出自《世说新语·假谲》，曹操说前方有梅林，士兵们想到梅子就流口水，暂时解渴。",
                options: ["渴", "饿", "累", "困"]
            },
            {
                question: "掩耳盗__",
                answer: "铃",
                hint: "比喻自己欺骗自己，明明掩盖不住的事情偏要想法子掩盖。",
                hintText: "出自《吕氏春秋·自知》，有人偷铃铛时捂住自己的耳朵，以为别人也听不到。",
                options: ["铃", "钟", "鼓", "锣"]
            },
            {
                question: "杯弓__影",
                answer: "蛇",
                hint: "比喻因疑神疑鬼而引起恐惧。",
                hintText: "出自《晋书·乐广传》，有人把墙上的弓影误认为是酒杯中的蛇，吓出病来。",
                options: ["蛇", "龙", "虫", "影"]
            }
        ];

        // 歌词题库（增加提示内容）
        const lyricQuestions = [
            {
                lyric: "我和你吻别，在无人的街",
                answer: "吻别",
                hintText: "这首歌是张学友1993年发行的专辑《吻别》的主打歌，也是他的代表作之一。",
                options: ["吻别", "祝福", "一路上有你", "忘记你我做不到"]
            },
            {
                lyric: "让我欢喜让我忧，让我甘心为了你付出我所有",
                answer: "让我欢喜让我忧",
                hintText: "这是周华健1991年的歌曲，由李宗盛作词作曲，收录在同名专辑中。",
                options: ["让我欢喜让我忧", "朋友", "爱相随", "花心"]
            },
            {
                lyric: "你问我爱你有多深，我爱你有几分",
                answer: "月亮代表我的心",
                hintText: "这首歌原唱是陈芬兰，但最著名的版本是邓丽君的演唱，发表于1977年。",
                options: ["月亮代表我的心", "甜蜜蜜", "小城故事", "但愿人长久"]
            },
            {
                lyric: "甜蜜蜜，你笑得甜蜜蜜",
                answer: "甜蜜蜜",
                hintText: "这首歌是邓丽君1979年的歌曲，也是电影《甜蜜蜜》的主题曲。",
                options: ["甜蜜蜜", "小城故事", "我只在乎你", "月亮代表我的心"]
            },
            {
                lyric: "我送你离开，千里之外，你无声黑白",
                answer: "千里之外",
                hintText: "这首歌由周杰伦和费玉清合唱，收录在周杰伦2006年的专辑《依然范特西》中。",
                options: ["千里之外", "青花瓷", "菊花台", "东风破"]
            },
            {
                lyric: "简单点，说话的方式简单点",
                answer: "演员",
                hintText: "这是薛之谦2015年发行的歌曲，收录在专辑《绅士》中。",
                options: ["演员", "丑八怪", "绅士", "你还要我怎样"]
            },
            {
                lyric: "谁在用琵琶弹奏一曲东风破",
                answer: "东风破",
                hintText: "这是周杰伦2003年发行的歌曲，收录在专辑《叶惠美》中，是中国风歌曲的代表作。",
                options: ["东风破", "青花瓷", "发如雪", "菊花台"]
            },
            {
                lyric: "如果那两个字没有颤抖，我不会发现我难受",
                answer: "十年",
                hintText: "这是陈奕迅2003年发行的歌曲，收录在专辑《黑白灰》中，是他的代表作之一。",
                options: ["十年", "爱情转移", "K歌之王", "你的背包"]
            }
        ];

        // DOM元素
        const pages = {
            login: document.getElementById('loginPage'),
            register: document.getElementById('registerPage'),
            gameHome: document.getElementById('gameHomePage'),
            rules: document.getElementById('rulesPage'),
            idiomGame: document.getElementById('idiomGamePage'),
            lyricGame: document.getElementById('lyricGamePage'),
            result: document.getElementById('resultPage'),
            ranking: document.getElementById('rankingPage')
        };

        // 初始化
        document.addEventListener('DOMContentLoaded', function() {
            initEventListeners();
            updateDateTime();
            setInterval(updateDateTime, 1000);
            
            // 检查是否有已登录用户
            const loggedInUser = localStorage.getItem('quizGameLoggedInUser');
            if (loggedInUser) {
                gameData.currentUser = JSON.parse(loggedInUser);
                showPage('gameHome');
                updateUserStats();
            } else {
                showPage('login');
            }
        });

        // 初始化事件监听器
        function initEventListeners() {
            // 登录注册切换
            document.getElementById('goToRegister').addEventListener('click', () => showPage('register'));
            document.getElementById('goToLogin').addEventListener('click', () => showPage('login'));
            
            // 登录按钮
            document.getElementById('loginBtn').addEventListener('click', login);
            
            // 注册按钮
            document.getElementById('registerBtn').addEventListener('click', register);
            
            // 游戏模式选择
            document.getElementById('idiomMode').addEventListener('click', () => startGame('idiom'));
            document.getElementById('lyricMode').addEventListener('click', () => startGame('lyric'));
            
            // 游戏规则
            document.getElementById('rulesBtn').addEventListener('click', () => showPage('rules'));
            document.getElementById('backFromRules').addEventListener('click', () => showPage('gameHome'));
            
            // 排行榜
            document.getElementById('rankingBtn').addEventListener('click', showRanking);
            document.getElementById('backFromRanking').addEventListener('click', () => showPage('gameHome'));
            
            // 退出登录
            document.getElementById('logoutBtn').addEventListener('click', logout);
            
            // 退出游戏按钮
            document.getElementById('quitIdiomGame').addEventListener('click', quitGame);
            document.getElementById('quitLyricGame').addEventListener('click', quitGame);
            
            // 下一题按钮
            document.getElementById('nextIdiomQuestion').addEventListener('click', nextQuestion);
            document.getElementById('nextLyricQuestion').addEventListener('click', nextQuestion);
            
            // 提示按钮
            document.getElementById('idiomHintBtn').addEventListener('click', () => useHint('idiom'));
            document.getElementById('lyricHintBtn').addEventListener('click', () => useHint('lyric'));
            
            // 返回主界面按钮
            document.getElementById('backToHome').addEventListener('click', () => showPage('gameHome'));
        }

        // 显示指定页面
        function showPage(pageName) {
            // 隐藏所有页面
            Object.values(pages).forEach(page => {
                page.classList.remove('active');
            });
            
            // 显示目标页面
            pages[pageName].classList.add('active');
            
            // 如果是游戏主页，更新用户数据
            if (pageName === 'gameHome') {
                updateUserStats();
            }
            
            // 如果是排行榜页面，更新排行榜
            if (pageName === 'ranking') {
                updateRanking();
            }
        }

        // 更新日期时间
        function updateDateTime() {
            const now = new Date();
            const dateStr = now.toLocaleDateString('zh-CN', { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric',
                weekday: 'long'
            });
            const timeStr = now.toLocaleTimeString('zh-CN', { 
                hour: '2-digit', 
                minute: '2-digit',
                second: '2-digit'
            });
            document.getElementById('dateTime').textContent = `${dateStr} ${timeStr}`;
        }

        // 登录功能
        function login() {
            const username = document.getElementById('loginUsername').value.trim();
            const password = document.getElementById('loginPassword').value.trim();
            
            if (!username || !password) {
                alert('请输入用户名和密码！');
                return;
            }
            
            const user = gameData.users.find(u => u.username === username && u.password === password);
            
            if (user) {
                gameData.currentUser = user;
                localStorage.setItem('quizGameLoggedInUser', JSON.stringify(user));
                showPage('gameHome');
                updateUserStats();
                
                // 更新欢迎消息
                document.getElementById('welcomeMessage').textContent = `欢迎回来，${user.username}！`;
                
                // 清空登录表单
                document.getElementById('loginUsername').value = '';
                document.getElementById('loginPassword').value = '';
            } else {
                alert('用户名或密码错误！');
            }
        }

        // 注册功能
        function register() {
            const username = document.getElementById('registerUsername').value.trim();
            const password = document.getElementById('registerPassword').value.trim();
            const confirmPassword = document.getElementById('confirmPassword').value.trim();
            
            if (!username || !password || !confirmPassword) {
                alert('请填写所有字段！');
                return;
            }
            
            if (password.length < 6) {
                alert('密码至少需要6位！');
                return;
            }
            
            if (password !== confirmPassword) {
                alert('两次输入的密码不一致！');
                return;
            }
            
            // 检查用户名是否已存在
            if (gameData.users.find(u => u.username === username)) {
                alert('用户名已存在！');
                return;
            }
            
            // 创建新用户
            const newUser = {
                username,
                password,
                totalStars: 0,
                gamesPlayed: 0,
                bestScore: 0,
                idiomPlayed: 0,
                idiomBest: 0,
                lyricPlayed: 0,
                lyricBest: 0,
                lastPlayed: new Date().toISOString()
            };
            
            gameData.users.push(newUser);
            localStorage.setItem('quizGameUsers', JSON.stringify(gameData.users));
            
            // 自动登录
            gameData.currentUser = newUser;
            localStorage.setItem('quizGameLoggedInUser', JSON.stringify(newUser));
            
            showPage('gameHome');
            updateUserStats();
            
            // 更新欢迎消息
            document.getElementById('welcomeMessage').textContent = `欢迎，${newUser.username}！`;
            
            // 清空注册表单
            document.getElementById('registerUsername').value = '';
            document.getElementById('registerPassword').value = '';
            document.getElementById('confirmPassword').value = '';
            
            alert('注册成功！已自动登录。');
        }

        // 退出登录
        function logout() {
            gameData.currentUser = null;
            localStorage.removeItem('quizGameLoggedInUser');
            showPage('login');
        }

        // 更新用户统计数据
        function updateUserStats() {
            if (!gameData.currentUser) return;
            
            document.getElementById('totalStars').textContent = gameData.currentUser.totalStars;
            document.getElementById('gamesPlayed').textContent = gameData.currentUser.gamesPlayed;
            document.getElementById('bestScore').textContent = gameData.currentUser.bestScore;
            document.getElementById('idiomPlayed').textContent = gameData.currentUser.idiomPlayed;
            document.getElementById('idiomBest').textContent = gameData.currentUser.idiomBest;
            document.getElementById('lyricPlayed').textContent = gameData.currentUser.lyricPlayed;
            document.getElementById('lyricBest').textContent = gameData.currentUser.lyricBest;
        }

        // 开始游戏
        function startGame(mode) {
            if (!gameData.currentUser) {
                alert('请先登录！');
                showPage('login');
                return;
            }
            
            gameData.currentGame.mode = mode;
            gameData.currentGame.questions = mode === 'idiom' ? [...idiomQuestions] : [...lyricQuestions];
            
            // 随机打乱问题顺序
            shuffleArray(gameData.currentGame.questions);
            
            // 重置游戏状态
            gameData.currentGame.currentQuestionIndex = 0;
            gameData.currentGame.hearts = 3;
            gameData.currentGame.stars = 0;
            gameData.currentGame.correctAnswers = 0;
            gameData.currentGame.startTime = new Date();
            gameData.currentGame.totalTime = 0;
            gameData.currentGame.hintsUsed = 0;
            gameData.currentGame.currentQuestionHintUsed = false;
            
            // 显示游戏页面
            showPage(mode === 'idiom' ? 'idiomGame' : 'lyricGame');
            
            // 加载第一题
            loadQuestion();
            
            // 开始计时器
            startTimer(mode);
        }

        // 洗牌算法，用于随机打乱数组
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // 加载题目
        function loadQuestion() {
            const game = gameData.currentGame;
            const question = game.questions[game.currentQuestionIndex];
            const isIdiom = game.mode === 'idiom';
            
            // 重置当前题目提示状态
            game.currentQuestionHintUsed = false;
            
            // 更新题目编号
            if (isIdiom) {
                document.getElementById('idiomQuestionNum').textContent = game.currentQuestionIndex + 1;
                document.getElementById('idiomQuestion').textContent = question.question;
                document.getElementById('idiomHint').textContent = `提示：${question.hint}`;
                
                // 隐藏提示容器
                document.getElementById('idiomHintContainer').style.display = 'none';
                
                // 重置提示按钮
                document.getElementById('idiomHintBtn').disabled = false;
                document.getElementById('idiomHintBtn').innerHTML = '<i class="fas fa-lightbulb"></i> 获取提示 (消耗1⭐)';
                
                // 更新爱心显示
                updateHearts('heart', game.hearts, 1);
                
                // 更新星星显示
                document.getElementById('currentStars').textContent = game.stars;
                
                // 生成选项
                const optionsContainer = document.getElementById('idiomOptions');
                optionsContainer.innerHTML = '';
                
                // 打乱选项顺序
                const shuffledOptions = shuffleArray([...question.options]);
                
                shuffledOptions.forEach(option => {
                    const optionElement = document.createElement('div');
                    optionElement.className = 'option';
                    optionElement.textContent = option;
                    optionElement.addEventListener('click', () => selectOption(option, question.answer, optionElement));
                    optionsContainer.appendChild(optionElement);
                });
                
                // 禁用下一题按钮
                document.getElementById('nextIdiomQuestion').disabled = true;
            } else {
                // 歌词模式
                document.getElementById('lyricQuestionNum').textContent = game.currentQuestionIndex + 1;
                document.getElementById('lyricQuestion').textContent = `"${question.lyric}"`;
                
                // 隐藏提示容器
                document.getElementById('lyricHintContainer').style.display = 'none';
                
                // 重置提示按钮
                document.getElementById('lyricHintBtn').disabled = false;
                document.getElementById('lyricHintBtn').innerHTML = '<i class="fas fa-lightbulb"></i> 获取提示 (消耗1⭐)';
                
                // 更新爱心显示
                updateHearts('heart', game.hearts, 4);
                
                // 更新星星显示
                document.getElementById('currentLyricStars').textContent = game.stars;
                
                // 生成选项
                const optionsContainer = document.getElementById('lyricOptions');
                optionsContainer.innerHTML = '';
                
                // 打乱选项顺序
                const shuffledOptions = shuffleArray([...question.options]);
                
                shuffledOptions.forEach(option => {
                    const optionElement = document.createElement('div');
                    optionElement.className = 'option';
                    optionElement.textContent = option;
                    optionElement.addEventListener('click', () => selectOption(option, question.answer, optionElement));
                    optionsContainer.appendChild(optionElement);
                });
                
                // 禁用下一题按钮
                document.getElementById('nextLyricQuestion').disabled = true;
            }
        }

        // 更新爱心显示
        function updateHearts(prefix, count, startIndex) {
            for (let i = 0; i < 3; i++) {
                const heartId = `${prefix}${startIndex + i}`;
                const heartElement = document.getElementById(heartId);
                if (heartElement) {
                    heartElement.style.opacity = i < count ? '1' : '0.3';
                }
            }
        }

        // 开始计时器
        function startTimer(mode) {
            const timerId = mode === 'idiom' ? 'idiomTimer' : 'lyricTimer';
            const timeLimit = mode === 'idiom' ? 30 : 20;
            
            let timeLeft = timeLimit;
            document.getElementById(timerId).textContent = timeLeft;
            
            gameData.currentGame.timer = setInterval(() => {
                timeLeft--;
                document.getElementById(timerId).textContent = timeLeft;
                
                if (timeLeft <= 0) {
                    clearInterval(gameData.currentGame.timer);
                    // 时间到，自动判断为错误
                    handleWrongAnswer();
                }
            }, 1000);
        }

        // 使用提示
        function useHint(mode) {
            const game = gameData.currentGame;
            const question = game.questions[game.currentQuestionIndex];
            const isIdiom = mode === 'idiom';
            
            // 如果已经使用过提示，不能再使用
            if (game.currentQuestionHintUsed) {
                alert('本题已经使用过提示了！');
                return;
            }
            
            // 显示提示内容
            if (isIdiom) {
                document.getElementById('idiomHintContent').textContent = question.hintText;
                document.getElementById('idiomHintContainer').style.display = 'block';
                document.getElementById('idiomHintBtn').innerHTML = '<i class="fas fa-lightbulb"></i> 提示已使用';
                document.getElementById('idiomHintBtn').disabled = true;
            } else {
                document.getElementById('lyricHintContent').textContent = question.hintText;
                document.getElementById('lyricHintContainer').style.display = 'block';
                document.getElementById('lyricHintBtn').innerHTML = '<i class="fas fa-lightbulb"></i> 提示已使用';
                document.getElementById('lyricHintBtn').disabled = true;
            }
            
            // 标记当前题目已使用提示
            game.currentQuestionHintUsed = true;
            game.hintsUsed++;
            
            // 提示使用动画效果
            const hintBtn = isIdiom ? document.getElementById('idiomHintBtn') : document.getElementById('lyricHintBtn');
            hintBtn.style.animation = 'none';
            setTimeout(() => {
                hintBtn.style.animation = 'pulse 0.5s';
            }, 10);
        }

        // 选择选项
        function selectOption(selected, correct, element) {
            const game = gameData.currentGame;
            const isIdiom = game.mode === 'idiom';
            const options = element.parentElement.children;
            
            // 清除之前可能设置的选中状态
            Array.from(options).forEach(opt => {
                opt.classList.remove('selected', 'correct', 'incorrect');
            });
            
            // 标记选中的选项
            element.classList.add('selected');
            
            // 检查答案
            if (selected === correct) {
                // 回答正确
                element.classList.add('correct');
                game.correctAnswers++;
                
                // 根据是否使用提示计算星星
                let starsEarned = isIdiom ? 2 : 3;
                if (game.currentQuestionHintUsed) {
                    starsEarned = isIdiom ? 1 : 2; // 使用提示后减少星星
                }
                game.stars += starsEarned;
                
                // 更新星星显示
                if (isIdiom) {
                    document.getElementById('currentStars').textContent = game.stars;
                } else {
                    document.getElementById('currentLyricStars').textContent = game.stars;
                }
            } else {
                // 回答错误
                element.classList.add('incorrect');
                game.hearts--;
                
                // 标记正确答案
                Array.from(options).forEach(opt => {
                    if (opt.textContent === correct) {
                        opt.classList.add('correct');
                    }
                });
                
                // 更新爱心显示
                updateHearts('heart', game.hearts, isIdiom ? 1 : 4);
                
                // 检查游戏是否结束
                if (game.hearts <= 0) {
                    setTimeout(() => endGame(), 1500);
                    return;
                }
            }
            
            // 启用下一题按钮
            if (isIdiom) {
                document.getElementById('nextIdiomQuestion').disabled = false;
            } else {
                document.getElementById('nextLyricQuestion').disabled = false;
            }
            
            // 停止计时器
            clearInterval(gameData.currentGame.timer);
        }

        // 处理错误答案（时间到的情况）
        function handleWrongAnswer() {
            const game = gameData.currentGame;
            const isIdiom = game.mode === 'idiom';
            
            game.hearts--;
            
            // 更新爱心显示
            updateHearts('heart', game.hearts, isIdiom ? 1 : 4);
            
            // 显示正确答案
            const options = isIdiom ? 
                document.getElementById('idiomOptions').children :
                document.getElementById('lyricOptions').children;
            
            const correctAnswer = game.questions[game.currentQuestionIndex].answer;
            
            Array.from(options).forEach(opt => {
                if (opt.textContent === correctAnswer) {
                    opt.classList.add('correct');
                }
            });
            
            // 启用下一题按钮
            if (isIdiom) {
                document.getElementById('nextIdiomQuestion').disabled = false;
            } else {
                document.getElementById('nextLyricQuestion').disabled = false;
            }
            
            // 检查游戏是否结束
            if (game.hearts <= 0) {
                setTimeout(() => endGame(), 1500);
            }
        }

        // 下一题
        function nextQuestion() {
            const game = gameData.currentGame;
            game.currentQuestionIndex++;
            
            // 检查是否还有下一题
            if (game.currentQuestionIndex < game.questions.length) {
                loadQuestion();
                
                // 重新开始计时器
                const mode = game.mode;
                const timerId = mode === 'idiom' ? 'idiomTimer' : 'lyricTimer';
                const timeLimit = mode === 'idiom' ? 30 : 20;
                
                let timeLeft = timeLimit;
                document.getElementById(timerId).textContent = timeLeft;
                
                gameData.currentGame.timer = setInterval(() => {
                    timeLeft--;
                    document.getElementById(timerId).textContent = timeLeft;
                    
                    if (timeLeft <= 0) {
                        clearInterval(gameData.currentGame.timer);
                        handleWrongAnswer();
                    }
                }, 1000);
            } else {
                // 所有题目完成
                endGame();
            }
        }

        // 结束游戏
        function endGame() {
            const game = gameData.currentGame;
            
            // 停止计时器
            clearInterval(gameData.currentGame.timer);
            
            // 计算总用时
            const endTime = new Date();
            game.totalTime = Math.floor((endTime - game.startTime) / 1000);
            
            // 更新用户数据
            updateUserAfterGame();
            
            // 显示结果页面
            showResult();
        }

        // 退出游戏
        function quitGame() {
            if (confirm('确定要退出游戏吗？当前进度将不会保存。')) {
                clearInterval(gameData.currentGame.timer);
                showPage('gameHome');
            }
        }

        // 游戏结束后更新用户数据
        function updateUserAfterGame() {
            const game = gameData.currentGame;
            const user = gameData.currentUser;
            
            // 更新用户数据
            user.totalStars += game.stars;
            user.gamesPlayed++;
            
            if (game.mode === 'idiom') {
                user.idiomPlayed++;
                if (game.stars > user.idiomBest) {
                    user.idiomBest = game.stars;
                }
            } else {
                user.lyricPlayed++;
                if (game.stars > user.lyricBest) {
                    user.lyricBest = game.stars;
                }
            }
            
            // 更新最高得分
            if (game.stars > user.bestScore) {
                user.bestScore = game.stars;
            }
            
            user.lastPlayed = new Date().toISOString();
            
            // 更新本地存储
            const userIndex = gameData.users.findIndex(u => u.username === user.username);
            if (userIndex !== -1) {
                gameData.users[userIndex] = user;
                localStorage.setItem('quizGameUsers', JSON.stringify(gameData.users));
                localStorage.setItem('quizGameLoggedInUser', JSON.stringify(user));
            }
            
            // 更新排行榜
            updateRankingData(user);
        }

        // 更新排行榜数据
        function updateRankingData(user) {
            // 查找用户是否已在排行榜中
            const rankIndex = gameData.rankings.findIndex(r => r.username === user.username);
            
            if (rankIndex !== -1) {
                // 更新现有用户
                gameData.rankings[rankIndex].totalStars = user.totalStars;
                gameData.rankings[rankIndex].bestScore = user.bestScore;
                gameData.rankings[rankIndex].gamesPlayed = user.gamesPlayed;
                gameData.rankings[rankIndex].lastPlayed = user.lastPlayed;
            } else {
                // 添加新用户
                gameData.rankings.push({
                    username: user.username,
                    totalStars: user.totalStars,
                    bestScore: user.bestScore,
                    gamesPlayed: user.gamesPlayed,
                    lastPlayed: user.lastPlayed
                });
            }
            
            // 按总星星数降序排序
            gameData.rankings.sort((a, b) => b.totalStars - a.totalStars);
            
            // 保存到本地存储
            localStorage.setItem('quizGameRankings', JSON.stringify(gameData.rankings));
        }

        // 显示游戏结果
        function showResult() {
            const game = gameData.currentGame;
            
            // 设置结果标题
            const title = game.hearts > 0 ? '恭喜完成游戏！' : '游戏结束';
            document.getElementById('resultTitle').textContent = title;
            
            // 设置得分
            document.getElementById('finalScore').textContent = `${game.stars} ⭐`;
            
            // 设置统计数据
            document.getElementById('resultCorrect').textContent = game.correctAnswers;
            document.getElementById('resultTime').textContent = game.totalTime;
            document.getElementById('resultStars').textContent = game.stars;
            document.getElementById('resultHints').textContent = game.hintsUsed;
            
            showPage('result');
        }

        // 显示排行榜
        function showRanking() {
            updateRanking();
            showPage('ranking');
        }

        // 更新排行榜显示
        function updateRanking() {
            const rankingBody = document.getElementById('rankingBody');
            rankingBody.innerHTML = '';
            
            // 获取前10名玩家
            const topPlayers = gameData.rankings.slice(0, 10);
            
            if (topPlayers.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `<td colspan="5" style="text-align: center; padding: 40px; color: #666;">暂无排名数据，快来成为第一个玩家吧！</td>`;
                rankingBody.appendChild(row);
                return;
            }
            
            topPlayers.forEach((player, index) => {
                const row = document.createElement('tr');
                
                // 设置排名样式
                let rankClass = '';
                if (index === 0) rankClass = 'rank-1';
                else if (index === 1) rankClass = 'rank-2';
                else if (index === 2) rankClass = 'rank-3';
                
                row.innerHTML = `
                    <td class="rank ${rankClass}">${index + 1}</td>
                    <td>${player.username}</td>
                    <td>${player.totalStars}</td>
                    <td>${player.bestScore}</td>
                    <td>${player.gamesPlayed}</td>
                `;
                
                // 如果是当前用户，高亮显示
                if (gameData.currentUser && player.username === gameData.currentUser.username) {
                    row.style.backgroundColor = '#f0f0ff';
                    row.style.fontWeight = '600';
                }
                
                rankingBody.appendChild(row);
            });
        }
    </script>
</body>
</html>
